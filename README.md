# WhatsApp Logger ‚Äî Dashboard + API
> TL;DR: Dashboard em tempo real via SSE, suporte a texto, imagem, √°udio/ptt, sticker e docs, m√≠dia servida com Content-Type correto, persist√™ncia em Mongo e buffer ass√≠ncrono via Redis (flush ajust√°vel). Prote√ß√£o opcional com DASH_TOKEN.


## ‚ú® Principais recursos

- üîå SSE (/events) para status, QR Code e mensagens em tempo real

- üñºÔ∏è M√≠dia salva em disco + /media com Content-Type correto (imagem/√°udio/v√≠deo/sticker/doc)

- üß† Anti-duplica√ß√£o e bolha otimista no front

- üóÑÔ∏è MongoDB com √≠ndices + TTL opcional (MSG_TTL_DAYS)

- üß∞ Redis opcional para flush em lote (FLUSH_SECONDS, FLUSH_BATCH_LIMIT)

- üîí DASH_TOKEN para proteger /events, /send, /messages, /chats

- üõ†Ô∏è Pronto para Docker/Render (PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium)

## üß≠ Documenta√ß√£o completa dos endpoints

> Leia a documenta√ß√£o rica em exemplos (cURL/fetch) em public/documentacao.html 

Resumo r√°pido:

GET /events ‚Äî stream SSE (status, qr, message)

POST /send ‚Äî { to, body } texto

GET /messages ‚Äî hist√≥rico (filtros: limit, chatId, days)

GET /chats ‚Äî √∫ltimas por chat (filtro: days)

GET /healthz ‚Äî health check

GET /media/:id.ext e GET /media/by-id/:id ‚Äî servir m√≠dia

## ‚öôÔ∏è Vari√°veis de ambiente (essenciais)

| Vari√°vel                    |                  Padr√£o | Descri√ß√£o                                                           |
| --------------------------- | ----------------------: | ------------------------------------------------------------------- |
| `PORT`                      |                 `10000` | Porta HTTP                                                          |
| `DASH_TOKEN`                |                       ‚Äî | Token do painel (protege `/events`, `/send`, `/messages`, `/chats`) |
| `MONGODB_URI`               |                       ‚Äî | String de conex√£o                                                   |
| `MONGO_DB` / `MONGO_COL`    | `whatsapp` / `messages` | Banco/Cole√ß√£o                                                       |
| `MSG_TTL_DAYS`              |                     `0` | TTL por `createdAt` (0 = desliga)                                   |
| `REDIS_URL`                 |                       ‚Äî | Ativa buffer e flush ass√≠ncrono                                     |
| `FLUSH_SECONDS`             |                  `3600` | Intervalo do flush em segundos                                      |
| `FLUSH_BATCH_LIMIT`         |                  `5000` | M√°x itens por flush                                                 |
| `MEDIA_DIR`                 |       `/app/data/media` | Pasta de m√≠dia                                                      |
| `WWEBJS_CLIENT_ID`          |          `whatsapp-bot` | ID da sess√£o                                                        |
| `WWEBJS_STORE`              |      `/app/data/wwebjs` | Persist√™ncia local                                                  |
| `PUPPETEER_EXECUTABLE_PATH` |     `/usr/bin/chromium` | Chromium (Docker/Render)                                            |

## üèÅ Quickstart

1) Copie e edite seu .env
> cp .env.example .env
2) Suba em Docker
> docker compose up -d --build
-3) Acesse
> Painel:        http://localhost:10000/
> Documenta√ß√£o:  http://localhost:10000/documentacao.html   (ou /docs/)
